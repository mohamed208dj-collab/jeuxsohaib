<!DOCTYPE html>
<html lang="ar" dir="rtl">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>X-O Ultra Pro Max</title>
    <link href="https://fonts.googleapis.com/css2?family=Cairo:wght@400;700;900&display=swap" rel="stylesheet">
    <script src="https://cdn.jsdelivr.net/npm/canvas-confetti@1.6.0/dist/confetti.browser.min.js"></script>
    <style>
        :root {
            --bg: #020617;
            --card: rgba(15, 23, 42, 0.8);
            --cyan: #06b6d4;
            --pink: #ec4899;
            --gold: #f59e0b;
        }

        body {
            margin: 0;
            height: 100vh;
            display: flex;
            align-items: center;
            justify-content: center;
            background-color: var(--bg);
            font-family: 'Cairo', sans-serif;
            color: white;
            overflow: hidden;
            /* ÿÆŸÑŸÅŸäÿ© ŸÖÿ™ÿ≠ÿ±ŸÉÿ© ÿ£ÿ≥ÿ∑Ÿàÿ±Ÿäÿ© */
            background: linear-gradient(135deg, #020617 0%, #0f172a 50%, #020617 100%);
            background-size: 400% 400%;
            animation: gradientBG 15s ease infinite;
        }

        @keyframes gradientBG {
            0% { background-position: 0% 50%; }
            50% { background-position: 100% 50%; }
            100% { background-position: 0% 50%; }
        }

        .container {
            width: 100%;
            max-width: 420px;
            padding: 25px;
            background: var(--card);
            backdrop-filter: blur(20px);
            border: 1px solid rgba(255, 255, 255, 0.1);
            border-radius: 35px;
            box-shadow: 0 50px 100px rgba(0,0,0,0.7);
            text-align: center;
        }

        .scoreboard {
            display: grid;
            grid-template-columns: 1fr 1fr 1fr;
            background: rgba(0,0,0,0.3);
            border-radius: 20px;
            padding: 15px;
            margin-bottom: 20px;
        }

        .score-box h3 { margin: 0; font-size: 0.8rem; opacity: 0.6; }
        .score-box p { margin: 5px 0 0; font-size: 1.5rem; font-weight: 900; }

        .game-info {
            font-size: 1.2rem;
            margin-bottom: 20px;
            font-weight: 700;
            height: 35px;
        }

        .board {
            display: grid;
            grid-template-columns: repeat(3, 1fr);
            gap: 15px;
            margin-bottom: 25px;
        }

        .cell {
            aspect-ratio: 1;
            background: rgba(255,255,255,0.03);
            border: 1px solid rgba(255,255,255,0.1);
            border-radius: 20px;
            display: flex;
            align-items: center;
            justify-content: center;
            font-size: 3.5rem;
            cursor: pointer;
            transition: 0.3s cubic-bezier(0.175, 0.885, 0.32, 1.275);
        }

        .cell:hover {
            background: rgba(255,255,255,0.08);
            transform: scale(1.05);
        }

        .cell.x { color: var(--cyan); text-shadow: 0 0 20px var(--cyan); }
        .cell.o { color: var(--pink); text-shadow: 0 0 20px var(--pink); }

        .cell.winner {
            background: var(--gold) !important;
            color: black !important;
            box-shadow: 0 0 40px var(--gold);
        }

        .controls {
            display: flex;
            flex-direction: column;
            gap: 12px;
        }

        .mode-selector {
            display: flex;
            gap: 10px;
            justify-content: center;
            margin-bottom: 10px;
        }

        button {
            padding: 12px 25px;
            border: none;
            border-radius: 15px;
            font-weight: 900;
            cursor: pointer;
            transition: 0.3s;
            font-family: 'Cairo';
        }

        .btn-reset { background: white; color: black; }
        .btn-mode { background: rgba(255,255,255,0.1); color: white; border: 1px solid rgba(255,255,255,0.2); }
        .btn-mode.active { background: var(--cyan); border-color: var(--cyan); color: white; }

        button:hover { transform: translateY(-3px); box-shadow: 0 10px 20px rgba(0,0,0,0.3); }

    </style>
</head>
<body>

<div class="container">
    <div class="scoreboard">
        <div class="score-box"><h3>X (ÿ£ŸÜÿ™)</h3><p id="s-x">0</p></div>
        <div class="score-box"><h3>ÿ™ÿπÿßÿØŸÑ</h3><p id="s-d">0</p></div>
        <div class="score-box"><h3>O (ÿßŸÑÿÆÿµŸÖ)</h3><p id="s-o">0</p></div>
    </div>

    <div class="game-info" id="status">ÿ¨ŸàŸÑÿ© ÿßŸÑŸÑÿßÿπÿ® <span style="color:var(--cyan)">X</span></div>

    <div class="mode-selector">
        <button class="btn-mode active" id="pvp" onclick="setMode('pvp')">ÿµÿØŸäŸÇ üë•</button>
        <button class="btn-mode" id="pva" onclick="setMode('pva')">ÿ∞ŸÉÿßÿ° ÿßÿµÿ∑ŸÜÿßÿπŸä ü§ñ</button>
    </div>

    <div class="board" id="board">
        <div class="cell" onclick="makeMove(0)"></div>
        <div class="cell" onclick="makeMove(1)"></div>
        <div class="cell" onclick="makeMove(2)"></div>
        <div class="cell" onclick="makeMove(3)"></div>
        <div class="cell" onclick="makeMove(4)"></div>
        <div class="cell" onclick="makeMove(5)"></div>
        <div class="cell" onclick="makeMove(6)"></div>
        <div class="cell" onclick="makeMove(7)"></div>
        <div class="cell" onclick="makeMove(8)"></div>
    </div>

    <div class="controls">
        <button class="btn-reset" onclick="resetBoard()">ÿ•ÿπÿßÿØÿ© ÿßŸÑÿ¨ŸàŸÑÿ© üîÑ</button>
    </div>
</div>

<script>
    let board = ["", "", "", "", "", "", "", "", ""];
    let player = "X";
    let active = true;
    let mode = 'pvp';
    let scores = {X: 0, O: 0, D: 0};

    const cells = document.querySelectorAll('.cell');
    const statusTxt = document.getElementById('status');

    function setMode(m) {
        mode = m;
        document.getElementById('pvp').classList.toggle('active', m === 'pvp');
        document.getElementById('pva').classList.toggle('active', m === 'pva');
        resetBoard();
        scores = {X: 0, O: 0, D: 0};
        updateScore();
    }

    function makeMove(i) {
        if (board[i] || !active) return;
        
        executeMove(i, player);

        if (active && mode === 'pva' && player === 'O') {
            setTimeout(aiMove, 500);
        }
    }

    function executeMove(i, p) {
        board[i] = p;
        cells[i].innerHTML = `<span class="pop">${p}</span>`;
        cells[i].classList.add(p.toLowerCase());
        
        if (checkWin(board, p)) {
            endGame(p);
        } else if (board.every(c => c !== "")) {
            endGame('D');
        } else {
            player = player === "X" ? "O" : "X";
            statusTxt.innerHTML = `ÿ¨ŸàŸÑÿ© ÿßŸÑŸÑÿßÿπÿ® <span style="color:var(--${player === 'X' ? 'cyan' : 'pink'})">${player}</span>`;
            if(mode === 'pva' && player === 'O') aiMove();
        }
    }

    function aiMove() {
        if (!active) return;
        let bestScore = -Infinity;
        let move;
        for (let i = 0; i < 9; i++) {
            if (board[i] === "") {
                board[i] = "O";
                let score = minimax(board, 0, false);
                board[i] = "";
                if (score > bestScore) {
                    bestScore = score;
                    move = i;
                }
            }
        }
        executeMove(move, "O");
    }

    // ÿÆŸàÿßÿ±ÿ≤ŸÖŸäÿ© Minimax ŸÑÿ¨ÿπŸÑ ÿßŸÑŸÉŸÖÿ®ŸäŸàÿ™ÿ± ŸÖÿ≥ÿ™ÿ≠ŸäŸÑ ÿßŸÑŸÅŸàÿ≤ ÿπŸÑŸäŸá
    function minimax(b, depth, isMaximizing) {
        if (checkWin(b, "O")) return 10;
        if (checkWin(b, "X")) return -10;
        if (b.every(c => c !== "")) return 0;

        if (isMaximizing) {
            let bestScore = -Infinity;
            for (let i = 0; i < 9; i++) {
                if (b[i] === "") {
                    b[i] = "O";
                    let score = minimax(b, depth + 1, false);
                    b[i] = "";
                    bestScore = Math.max(score, bestScore);
                }
            }
            return bestScore;
        } else {
            let bestScore = Infinity;
            for (let i = 0; i < 9; i++) {
                if (b[i] === "") {
                    b[i] = "X";
                    let score = minimax(b, depth + 1, true);
                    b[i] = "";
                    bestScore = Math.min(score, bestScore);
                }
            }
            return bestScore;
        }
    }

    function checkWin(b, p) {
        const wins = [[0,1,2],[3,4,5],[6,7,8],[0,3,6],[1,4,7],[2,5,8],[0,4,8],[2,4,6]];
        return wins.some(pattern => {
            const win = pattern.every(idx => b[idx] === p);
            if(win && active && b === board) pattern.forEach(idx => cells[idx].classList.add('winner'));
            return win;
        });
    }

    function endGame(res) {
        active = false;
        if (res === 'D') {
            statusTxt.innerText = "ÿ™ÿπÿßÿØŸÑ ÿßŸÑÿ£ÿ®ÿ∑ÿßŸÑ! ü§ù";
            scores.D++;
        } else {
            statusTxt.innerHTML = `üèÜ ÿßŸÑŸÖŸÑŸÉ <span style="color:var(--${res==='X'?'cyan':'pink'})">${res}</span> ÿßŸÉÿ™ÿ≥ÿ≠ ÿßŸÑÿ≥ÿßÿ≠ÿ©!`;
            scores[res]++;
            confetti({ particleCount: 150, spread: 70, origin: { y: 0.6 } });
        }
        updateScore();
    }

    function updateScore() {
        document.getElementById('s-x').innerText = scores.X;
        document.getElementById('s-o').innerText = scores.O;
        document.getElementById('s-d').innerText = scores.D;
    }

    function resetBoard() {
        board = ["", "", "", "", "", "", "", "", ""];
        player = "X";
        active = true;
        statusTxt.innerHTML = `ÿ¨ŸàŸÑÿ© ÿßŸÑŸÑÿßÿπÿ® <span style="color:var(--cyan)">X</span>`;
        cells.forEach(c => {
            c.innerHTML = "";
            c.classList.remove('x', 'o', 'winner');
        });
    }
</script>
</body>
</html>
